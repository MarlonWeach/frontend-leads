# Atualizar o arquivo do workflow
cat > .github/workflows/sync-and-alerts.yml << 'EOF'
name: Sincronizar Dados e Gerar Alertas

on:
  schedule:
    # Executar a cada 2 horas
    - cron: '0 */2 * * *'
  workflow_dispatch: # Permite executar manualmente

jobs:
  sync-and-alerts:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v3
      
      - name: 1. Sincronizar Campanhas Meta
        run: |
          echo "ðŸš€ Iniciando sincronizaÃ§Ã£o de campanhas..."
          curl -X POST "${{ secrets.SUPABASE_URL }}/functions/v1/syncCampaigns" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{}' \
            --fail-with-body \
            --max-time 300
      
      - name: 2. Aguardar processamento
        run: sleep 30
      
      - name: 3. Gerar Alertas AutomÃ¡ticos
        run: |
          echo "ðŸ”” Gerando alertas automÃ¡ticos..."
          curl -X POST "${{ secrets.SUPABASE_URL }}/functions/v1/generate-alerts" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{}' \
            --fail-with-body \
            --max-time 120
      
      - name: 4. Log de Sucesso
        run: echo "âœ… SincronizaÃ§Ã£o e alertas concluÃ­dos em $(date)"

  # Job separado para executar apenas alertas (Ãºtil para debug)
  alerts-only:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Gerar Apenas Alertas
        run: |
          echo "ðŸ”” Executando apenas geraÃ§Ã£o de alertas..."
          curl -X POST "${{ secrets.SUPABASE_URL }}/functions/v1/generate-alerts" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{}' \
            --fail-with-body
EOF
