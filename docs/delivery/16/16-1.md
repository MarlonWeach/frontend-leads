# [16-1] Implementar sistema de atualização automática via GitHub Actions

[Back to task list](./tasks.md)

## Description
Criar um workflow do GitHub Actions que execute periodicamente para atualizar automaticamente a lista de anúncios ativos da Meta API, garantindo que o dashboard sempre tenha dados precisos e atualizados.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 21:10:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2025-01-27 21:10:00 | Status Update | Proposed | InProgress | Iniciando implementação do workflow GitHub Actions | AI Agent |

## Requirements
1. **Workflow GitHub Actions**
   - Execução a cada 6 horas (00:00, 06:00, 12:00, 18:00 UTC)
   - Integração com Meta API para buscar anúncios ativos
   - Tratamento de erros e retry automático
   - Logs estruturados para monitoramento

2. **Integração com Meta API**
   - Chamada ao endpoint `/ads` com filtro `effective_status=ACTIVE`
   - Autenticação via access token
   - Rate limiting adequado
   - Tratamento de paginação

3. **Atualização do Supabase**
   - Sincronização de status dos anúncios
   - Atualização de métricas agregadas
   - Logs de execução
   - Tratamento de conflitos

4. **Monitoramento**
   - Status de execução visível
   - Alertas para falhas
   - Métricas de performance
   - Logs estruturados

## Implementation Plan
1. **Criar Workflow GitHub Actions**
   - Criar arquivo `.github/workflows/sync-active-ads.yml`
   - Configurar triggers (cron schedule)
   - Definir jobs e steps
   - Configurar secrets e variáveis de ambiente

2. **Implementar Script de Sincronização**
   - Criar script `scripts/sync-active-ads.js`
   - Integração com Meta API
   - Lógica de sincronização com Supabase
   - Tratamento de erros e retry

3. **Configurar Variáveis de Ambiente**
   - Adicionar secrets no GitHub
   - Configurar variáveis no Supabase
   - Documentar configuração

4. **Implementar Logs e Monitoramento**
   - Logs estruturados com Pino
   - Métricas de execução
   - Status de sincronização
   - Alertas automáticos

## Verification
1. **Test Plan**
   - Executar script localmente
   - Verificar integração com Meta API
   - Validar sincronização com Supabase
   - Testar tratamento de erros

2. **Teste do Workflow**
   - Executar workflow manualmente
   - Verificar logs de execução
   - Validar atualização de dados
   - Testar retry automático

3. **Teste de Performance**
   - Medir tempo de execução
   - Verificar uso de recursos
   - Validar rate limiting
   - Testar com volume de dados

## Success Criteria
- ✅ Workflow executa automaticamente a cada 6 horas
- ✅ Anúncios ativos são sincronizados corretamente
- ✅ Dashboard exibe dados atualizados
- ✅ Logs estruturados são gerados
- ✅ Tratamento de erros funciona adequadamente
- ✅ Performance não é impactada negativamente

## Files Modified
- `.github/workflows/sync-active-ads.yml` (novo)
- `scripts/sync-active-ads.js` (novo)
- `docs/delivery/16/tasks.md` (atualizado)
- `docs/delivery/16/16-1.md` (novo) 