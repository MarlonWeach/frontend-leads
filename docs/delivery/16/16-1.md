# [16-1] Implementar serviço de integração com Meta API

[Back to task list](./tasks.md)

## Description
Criar um serviço dedicado para buscar anúncios ativos da Meta API, que será responsável por:
1. Fazer chamadas ao endpoint `/ads` com filtro `effective_status=ACTIVE`
2. Processar e validar a resposta
3. Retornar uma lista atualizada de anúncios ativos
4. Implementar tratamento de erros adequado

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2024-03-19 15:00:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2024-03-19 15:05:00 | Status Update | Proposed | Agreed | Task approved for implementation | AI Agent |

## Requirements
1. Criar novo serviço `MetaAdsService` em `src/services/meta/ads.ts`
2. Implementar método `getActiveAds()` que:
   - Faz chamada à Meta API usando o endpoint `/ads`
   - Usa o filtro `effective_status=ACTIVE`
   - Inclui campos necessários: `id`, `name`, `status`, `effective_status`
   - Implementa paginação adequada
3. Implementar tratamento de erros robusto
4. Adicionar logging estruturado
5. Implementar retry para falhas temporárias
6. Adicionar tipos TypeScript para todas as interfaces

## Implementation Plan
1. **Criar Estrutura Base**:
   - Criar arquivo `src/services/meta/ads.ts`
   - Definir interfaces TypeScript
   - Implementar classe base do serviço

2. **Implementar Método Principal**:
   - Criar método `getActiveAds()`
   - Implementar chamada à API com filtros
   - Adicionar paginação
   - Implementar retry logic

3. **Tratamento de Erros**:
   - Implementar classes de erro customizadas
   - Adicionar logging estruturado
   - Implementar retry para erros temporários

4. **Testes**:
   - Criar testes unitários
   - Implementar mocks para Meta API
   - Testar cenários de erro

## Verification
1. **Testes Unitários**:
   - Testar chamada bem-sucedida à API
   - Testar paginação
   - Testar tratamento de erros
   - Testar retry logic
   - Verificar tipos TypeScript

2. **Testes de Integração**:
   - Testar integração com Meta API real
   - Verificar paginação com dados reais
   - Testar cenários de erro reais

3. **Verificação Manual**:
   - Confirmar que a lista de anúncios ativos está correta
   - Verificar logs em caso de erro
   - Confirmar que o retry funciona adequadamente

## Files Modified
- `src/services/meta/ads.ts` (novo)
- `src/types/meta.ts` (novo)
- `src/utils/errors.ts` (modificar)
- `test/unit/services/meta/ads.test.ts` (novo)
- `test/integration/services/meta/ads.test.ts` (novo)

## Test Plan
1. **Objetivo**: Verificar que o serviço `MetaAdsService` consegue buscar corretamente anúncios ativos da Meta API

2. **Test Scope**:
   - Serviço `MetaAdsService`
   - Integração com Meta API
   - Tratamento de erros
   - Sistema de retry

3. **Environment & Setup**:
   - Ambiente de desenvolvimento
   - Token de acesso da Meta configurado
   - Mocks para testes unitários

4. **Mocking Strategy**:
   - Mock da Meta API para testes unitários
   - Dados reais para testes de integração

5. **Key Test Scenarios**:
   - Chamada bem-sucedida retorna lista de anúncios ativos
   - Paginação funciona corretamente
   - Erros de API são tratados adequadamente
   - Sistema de retry funciona para erros temporários
   - Logging é feito corretamente

6. **Success Criteria**:
   - Todos os testes unitários passam
   - Todos os testes de integração passam
   - Logging é feito corretamente
   - Tipos TypeScript estão corretos
   - Documentação está atualizada 